/*
*	touchClick.js v 2.0
*	Eliminates duplicate execution of script upon tap/click (Ghost clicks)
*
*	By: Dave Carney, 2019
*	dave@vehiclemedia.com
*
*	Requires jQuery-3.2.1
*
*	touchClick();
*		Usage:
*			$('EXAMPLE-ELEMENT').touchClick('OPTIONAL-NAMESPACE', function(e) {
*				console.log('a ' + e.originalEvent.type + ' event happened first');
*			});
*		To remove listener:
*			$('EXAMPLE-ELEMENT').touchClickOff('NAMESPACE-TO-REMOVE');
*
*	touchHover();
*		Pre-built (hover/click an element) --> (Show this other element) function
*		Used to perform "hovers" on touchscreens via adding .touch-active to the element
*		Usage:
*			Markup --> assign .touch-anchor to the element that will trigger the show/reveal
*			Markup --> assign .touch-target to the element that will be revealed (MUST be a child of the .touch-anchor element)
*			Style  --> .touch-target { display: none; }
*			Style  --> .touch-target.touch-active { display: WHATEVER; }
*		Notes:
*			Don't use pseudo-classes, .touch-anchor:hover {...}, they don't exist on touchscreens
*			The parent .touch-anchor will also get .touch-active in case you need to target that element as well
*/

!function(t){t.fn.touchClick=function(i,h){var e,o=this;"string"==typeof i||i instanceof String?e="click"+(i="."+i)+" touchend"+i+" pointerup"+i:(e="click touchend pointerup",h=i),t(this).on(e,function(t){"pointerup"===t.originalEvent.type&&(o.pointed=!0,o.hasRun=!1,o.touched=!0),o.hasRun?"touchend"===t.originalEvent.type?o.pointed?o.pointed=!1:(o.touched=!0,h(t)):o.touched?(o.touched=!1,o.pointed=!1):h(t):(h(t),o.hasRun=!0)})},t.fn.touchClickOff=function(i){var h="click."+i+" touchend."+i+" pointerup."+i;t(this).off(h)},t.fn.touchHover=function(){var i=[],h=0,e=this;function o(){e.each(function(){this.active=!1,this.activeChild=!1,this.allowClickThrough=!1,t(this).removeClass("touch-active"),this.hiddenItem.removeClass("touch-active")}),t(document).touchClickOff("outside"),t(document).off("mousemove.outside"),h=0}function c(t){i.push(setTimeout(function(){t.active&&(t.allowClickThrough=!0)},100))}e.each(function(){this.anchor=t(this),this.hiddenItem=t(this).find(".touch-target:first"),this.active=!1,this.activeChild=!1,this.allowClickThrough=!1,this.siblingAnchors=t(this).siblings(".touch-anchor"),this.childAnchors=t(this).find(".touch-anchor"),this.parentAnchors=t(this).parents(".touch-anchor"),this.parentAnchors.length?this.noParent=!1:this.noParent=!0,this.reveal=function(){this.activeItemCheck(),this.active=!0,t(this).addClass("touch-active"),this.hiddenItem.addClass("touch-active"),this.parentAnchors.each(function(){this.activeChild=!0}),0===h&&(t(document).touchClick("outside",function(i){t(i.target).closest(".touch-anchor").length||o()}),t(document).on("mousemove.outside",function(i){t(i.target).closest(".touch-anchor").length?t(i.target).closest(".touch-anchor")[0].activeChild&&t(i.target).closest(".touch-anchor")[0].childAnchors.each(function(){this.conceal()}):o()}),h++)},this.conceal=function(){this.active=!1,this.activeChild=!1,this.allowClickThrough=!1,t(this).removeClass("touch-active"),this.hiddenItem.removeClass("touch-active"),this.childAnchors.each(function(){this.active=!1,this.activeChild=!1,this.allowClickThrough=!1,this.removeClass("touch-active"),this.hiddenItem.removeClass("touch-active")})},this.activeItemCheck=function(){this.noParent?o():this.siblingAnchors.each(function(){this.active&&this.conceal()})}}),t(e).on("click touchend pointerup",function(t){this.allowClickThrough||(t.stopPropagation(),t.preventDefault(),c(this)),"pointerup"===t.originalEvent.type&&(this.pointed=!0,this.hasRun=!1,this.touched=!0),this.hasRun?"touchend"===t.originalEvent.type?this.pointed?this.pointed=!1:(this.touched=!0,this.active||this.reveal()):this.touched?(this.touched=!1,this.pointed=!1):this.active||this.reveal():(this.active||this.reveal(),this.hasRun=!0)}),t(e).on("mouseenter",function(){this.allowClickThrough||c(this),this.active||this.reveal()})},t(".touch-anchor").touchHover()}(jQuery);